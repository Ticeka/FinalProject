@page
@model FinalProject.Pages.Admin.Beers.EditModel
@{
    ViewData["Title"] = "แก้ไขเครื่องดื่ม (Admin)";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

<div class="container py-4">
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a asp-page="/Index">แผนที่</a></li>
            <li class="breadcrumb-item"><a asp-page="/List">รายการ</a></li>
            <li class="breadcrumb-item active" aria-current="page">แก้ไข (Admin)</li>
        </ol>
    </nav>

    <h1 class="h4 mb-3">แก้ไขข้อมูล Local Beer</h1>

    @if (TempData["Flash"] is string ok && !string.IsNullOrWhiteSpace(ok))
    {
        <div class="alert alert-success">@ok</div>
    }

    <form method="post" asp-antiforgery="true" novalidate>
        <input type="hidden" asp-for="Input.Id" />
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <!-- ข้อมูลหลัก -->
        <div class="mb-4">
            <h6 class="text-muted">ข้อมูลหลัก</h6>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">ชื่อ *</label>
                    <input class="form-control" asp-for="Input.Name" />
                    <span class="text-danger" asp-validation-for="Input.Name"></span>
                </div>
                <div class="col-md-6">
                    <label class="form-label">จังหวัด *</label>
                    <input class="form-control" asp-for="Input.Province" />
                    <span class="text-danger" asp-validation-for="Input.Province"></span>
                </div>
                <div class="col-md-6">
                    <label class="form-label">อำเภอ/เขต</label>
                    <input class="form-control" asp-for="Input.District" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">ประเภท (เช่น Lager / IPA)</label>
                    <input class="form-control" asp-for="Input.Type" />
                </div>
                <div class="col-12">
                    <label class="form-label">คำอธิบาย</label>
                    <textarea class="form-control" rows="3" asp-for="Input.Description"></textarea>
                </div>
            </div>
        </div>

        <!-- ที่ตั้ง & การติดต่อ -->
        <div class="mb-4">
            <h6 class="text-muted">ที่ตั้ง & การติดต่อ</h6>
            <div class="row g-3">
                <div class="col-12">
                    <label class="form-label">ที่อยู่</label>
                    <input class="form-control" asp-for="Input.Address" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Latitude</label>
                    <input type="number" step="0.000001" class="form-control" asp-for="Input.Latitude" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Longitude</label>
                    <input type="number" step="0.000001" class="form-control" asp-for="Input.Longitude" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Image URL</label>
                    <input class="form-control" asp-for="Input.ImageUrl" />
                    <div class="form-text">
                        ใส่ได้ทั้ง URL เต็ม (http/https), พาธที่ขึ้นต้นด้วย <code>/</code> หรือชื่อไฟล์ เช่น <code>beer.png</code>
                    </div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Website</label>
                    <input class="form-control" asp-for="Input.Website" />
                    <div class="form-text">ถ้าไม่ใส่ http/https ระบบจะเติม <code>https://</code> ให้อัตโนมัติ</div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Facebook Page</label>
                    <input class="form-control" asp-for="Input.FacebookPage" />
                    <div class="form-text">ใส่ได้ทั้ง <code>https://facebook.com/...</code> หรือ <code>facebook.com/...</code></div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">เบอร์โทร</label>
                    <input class="form-control" asp-for="Input.PhoneNumber" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">เวลาเปิด-ปิด</label>
                    <input class="form-control" asp-for="Input.OpenHours" />
                </div>
            </div>
        </div>

        <!-- ข้อมูลสินค้า/เครื่องดื่ม -->
        <div class="mb-4">
            <h6 class="text-muted">ข้อมูลสินค้า/เครื่องดื่ม</h6>
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Alcohol (%)</label>
                    <input type="number" step="0.1" class="form-control" asp-for="Input.AlcoholLevel" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">ราคา (บาท)</label>
                    <input type="number" step="0.01" class="form-control" asp-for="Input.Price" />
                    <span class="text-danger" asp-validation-for="Input.Price"></span>
                </div>
                <div class="col-md-3">
                    <label class="form-label">ปริมาตร (ml)</label>
                    <input type="number" class="form-control" asp-for="Input.Volume" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">ปีผลิต</label>
                    <input type="number" class="form-control" asp-for="Input.ProductYear" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">แหล่งกำเนิด (Place of Origin)</label>
                    <input class="form-control" asp-for="Input.PlaceOfOrigin" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">ภูมิภาค</label>
                    <input class="form-control" asp-for="Input.Region" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">ผู้ผลิต/ผู้สร้างสรรค์ (Creator)</label>
                    <input class="form-control" asp-for="Input.Creator" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">วัตถุดิบหลัก</label>
                    <input class="form-control" asp-for="Input.MainIngredients" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">กระบวนการผลิต</label>
                    <input class="form-control" asp-for="Input.ProductMethod" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">ประเภทสุรา</label>
                    <input class="form-control" asp-for="Input.TypeOfLiquor" />
                </div>
            </div>
        </div>

        <!-- สิทธิ์/การจัดจำหน่าย/รางวัล -->
        <div class="mb-4">
            <h6 class="text-muted">สิทธิ์ / การจัดจำหน่าย / รางวัล</h6>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">ลิขสิทธิ์/สิทธิ์</label>
                    <input class="form-control" asp-for="Input.Rights" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">ผู้จัดจำหน่าย</label>
                    <input class="form-control" asp-for="Input.Distributor" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">ช่องทางจัดจำหน่าย</label>
                    <input class="form-control" asp-for="Input.DistributorChanel" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">รางวัล</label>
                    <input class="form-control" asp-for="Input.Award" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">หมายเหตุ</label>
                    <input class="form-control" asp-for="Input.Notes" />
                </div>
            </div>
        </div>

        <!-- อ้างอิง/รหัสสินค้า -->
        <div class="mb-4">
            <h6 class="text-muted">อ้างอิง / รหัสสินค้า</h6>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Product ID</label>
                    <input class="form-control" asp-for="Input.ProductId" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Average Rating (ถ้ามี)</label>
                    <input type="number" step="0.1" class="form-control" asp-for="Input.AverageRating" />
                </div>
            </div>
        </div>

        <!-- Pairings (อย่างละ 1) -->
        <div class="mb-4">
            <h6 class="text-muted">Pairings (จำกัดอย่างละ 1)</h6>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Flavor</label>
                    <input class="form-control" asp-for="Input.Flavor" placeholder="เช่น Citrus / Herb / Sweet / Bitter" />
                </div>
                <div class="col-md-2">
                    <label class="form-label">Intensity</label>
                    <input type="number" step="0.1" class="form-control" asp-for="Input.FlavorIntensity" />
                </div>
                <div class="col-md-6"></div>

                <div class="col-md-6">
                    <label class="form-label">Food Pairing</label>
                    <input class="form-control" asp-for="Input.FoodName" placeholder="ชื่ออาหาร" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">เหตุผล (Food)</label>
                    <input class="form-control" asp-for="Input.FoodReason" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Mood</label>
                    <input class="form-control" asp-for="Input.Mood" placeholder="เช่น Party / Chill / Celebration" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">เหตุผล (Mood)</label>
                    <input class="form-control" asp-for="Input.MoodReason" />
                </div>
            </div>
        </div>

        <!-- ข้อมูลระบบ (อ่านอย่างเดียว) -->
        <div class="mb-4">
            <h6 class="text-muted">ข้อมูลระบบ (อ่านอย่างเดียว)</h6>
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Average Rating</label>
                    <input class="form-control" value="@(Model.Input.AverageRating?.ToString("0.0") ?? "-")" disabled />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Created At</label>
                    <input class="form-control" value="@Model.CreatedAtDisplay" disabled />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Updated At</label>
                    <input class="form-control" value="@Model.UpdatedAtDisplay" disabled />
                </div>
                <div class="col-md-3">
                    <label class="form-label">หมายเหตุ</label>
                    <input class="form-control" value="Rating/Count คำนวณในระบบ" disabled />
                </div>
            </div>
        </div>

        <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary" type="submit">บันทึก</button>
            <a class="btn btn-secondary" asp-page="/Detail" asp-route-id="@Model.Input.Id">ยกเลิก</a>
        </div>

        <partial name="_ValidationScriptsPartial" />
    </form>
</div>

@section Scripts {
    <script>
        (function(){
          // เติม https:// อัตโนมัติให้ Website / Facebook (ไม่แตะ ImageUrl เพราะอาจเป็นไฟล์หรือพาธ)
          function ensureHttps(id){
            const el = document.getElementById(id);
            if(!el) return;
            el.addEventListener('blur', () => {
              let v = (el.value || '').trim();
              if(!v) return;
              if (/^https?:\/\//i.test(v)) return;
              if (v.startsWith('/')) return; // เผื่อใครใส่ /... โดยไม่ตั้งใจ
              el.value = 'https://' + v;
            });
          }
          ensureHttps('Input_Website');
          ensureHttps('Input_FacebookPage');
        })();
    </script>
}
